<?xml version='1.0' encoding='utf-8'?>
<rfc xmlns:xi="http://www.w3.org/2001/XInclude" version="3" category="std" submissionType="IETF" ipr="trust200902" docName="draft-ietf-ipsecme-ikev2-qr-alt-10" number="9867" consensus="true" updates="" obsoletes="" xml:lang="en" tocInclude="true" symRefs="true" sortRefs="false" prepTime="2025-11-05T11:27:05" indexInclude="true" scripts="Common,Latin" tocDepth="3">
  <link href="https://datatracker.ietf.org/doc/draft-ietf-ipsecme-ikev2-qr-alt-10" rel="prev"/>
  <link href="https://dx.doi.org/10.17487/rfc9867" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  <front>
    <title abbrev="Enhanced Mixing PSKs in IKEv2 for PQ Security">Mixing Preshared Keys in the IKE_INTERMEDIATE and CREATE_CHILD_SA Exchanges of the Internet Key Exchange Protocol Version 2 (IKEv2) for Post-Quantum Security</title>
    <seriesInfo name="RFC" value="9867" stream="IETF"/>
    <author initials="V." surname="Smyslov" fullname="Valery Smyslov">
      <organization showOnFrontPage="true">ELVIS-PLUS</organization>
      <address>
        <postal>
          <street>PO Box 81</street>
          <city>Moscow (Zelenograd)</city>
          <code>124460</code>
          <country>Russian Federation</country>
        </postal>
        <phone>+7 495 276 0211</phone>
        <email>svan@elvis.ru</email>
      </address>
    </author>
    <date month="11" year="2025"/>
    <keyword>internet key exchange</keyword>
    <keyword>quantum computer</keyword>
    <keyword>post quantum</keyword>
    <keyword>post-quantum</keyword>
    <keyword>quantum safe</keyword>
    <keyword>PPK</keyword>
    <abstract pn="section-abstract">
      <t indent="0" pn="section-abstract-1"> An Internet Key Exchange Protocol Version 2 (IKEv2) extension defined in RFC 8784 allows IPsec 
            traffic to be protected against someone storing VPN communications 
            and decrypting them later, when (and if) a Cryptographically Relevant Quantum Computer (CRQC) is available. 
            The protection is achieved by means of a Post-quantum Preshared Key (PPK) that is mixed into the session keys calculation.
            However, this protection does not cover an initial IKEv2 Security Association (SA), which might be unacceptable in some scenarios. 
            This specification defines an alternative way to provide protection against quantum computers, which 
            is similar to the solution defined in RFC 8784, but it also protects the initial IKEv2 SA.
      </t>
      <t indent="0" pn="section-abstract-2"> RFC 8784 assumes that PPKs are static and thus they are only used when 
            an initial IKEv2 SA is created. If a fresh PPK is available before the IKE SA expires, 
            then the only way to use it is to delete the current IKE SA and create a new one from scratch, which is inefficient.
            This specification defines a way to use PPKs in active IKEv2 SAs for creating additional IPsec SAs and rekey operations.
      </t>
    </abstract>
    <boilerplate>
      <section anchor="status-of-memo" numbered="false" removeInRFC="false" toc="exclude" pn="section-boilerplate.1">
        <name slugifiedName="name-status-of-this-memo">Status of This Memo</name>
        <t indent="0" pn="section-boilerplate.1-1">
            This is an Internet Standards Track document.
        </t>
        <t indent="0" pn="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.
        </t>
        <t indent="0" pn="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <eref target="https://www.rfc-editor.org/info/rfc9867" brackets="none"/>.
        </t>
      </section>
      <section anchor="copyright" numbered="false" removeInRFC="false" toc="exclude" pn="section-boilerplate.2">
        <name slugifiedName="name-copyright-notice">Copyright Notice</name>
        <t indent="0" pn="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.
        </t>
        <t indent="0" pn="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<eref target="https://trustee.ietf.org/license-info" brackets="none"/>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.
        </t>
      </section>
    </boilerplate>
    <toc>
      <section anchor="toc" numbered="false" removeInRFC="false" toc="exclude" pn="section-toc.1">
        <name slugifiedName="name-table-of-contents">Table of Contents</name>
        <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1">
          <li pn="section-toc.1-1.1">
            <t indent="0" keepWithNext="true" pn="section-toc.1-1.1.1"><xref derivedContent="1" format="counter" sectionFormat="of" target="section-1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-introduction">Introduction</xref></t>
          </li>
          <li pn="section-toc.1-1.2">
            <t indent="0" keepWithNext="true" pn="section-toc.1-1.2.1"><xref derivedContent="2" format="counter" sectionFormat="of" target="section-2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-terminology-and-notation">Terminology and Notation</xref></t>
          </li>
          <li pn="section-toc.1-1.3">
            <t indent="0" pn="section-toc.1-1.3.1"><xref derivedContent="3" format="counter" sectionFormat="of" target="section-3"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-protocol-description">Protocol Description</xref></t>
            <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.3.2">
              <li pn="section-toc.1-1.3.2.1">
                <t indent="0" pn="section-toc.1-1.3.2.1.1"><xref derivedContent="3.1" format="counter" sectionFormat="of" target="section-3.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-creating-initial-ike-sa">Creating Initial IKE SA</xref></t>
                <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.3.2.1.2">
                  <li pn="section-toc.1-1.3.2.1.2.1">
                    <t indent="0" keepWithNext="true" pn="section-toc.1-1.3.2.1.2.1.1"><xref derivedContent="3.1.1" format="counter" sectionFormat="of" target="section-3.1.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-computing-ike-sa-keys">Computing IKE SA Keys</xref></t>
                  </li>
                </ul>
              </li>
              <li pn="section-toc.1-1.3.2.2">
                <t indent="0" pn="section-toc.1-1.3.2.2.1"><xref derivedContent="3.2" format="counter" sectionFormat="of" target="section-3.2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-using-ppks-in-the-create_ch">Using PPKs in the CREATE_CHILD_SA Exchange</xref></t>
                <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.3.2.2.2">
                  <li pn="section-toc.1-1.3.2.2.2.1">
                    <t indent="0" pn="section-toc.1-1.3.2.2.2.1.1"><xref derivedContent="3.2.1" format="counter" sectionFormat="of" target="section-3.2.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-computing-keys">Computing Keys</xref></t>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li pn="section-toc.1-1.4">
            <t indent="0" pn="section-toc.1-1.4.1"><xref derivedContent="4" format="counter" sectionFormat="of" target="section-4"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-security-considerations">Security Considerations</xref></t>
          </li>
          <li pn="section-toc.1-1.5">
            <t indent="0" pn="section-toc.1-1.5.1"><xref derivedContent="5" format="counter" sectionFormat="of" target="section-5"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-iana-considerations">IANA Considerations</xref></t>
          </li>
          <li pn="section-toc.1-1.6">
            <t indent="0" pn="section-toc.1-1.6.1"><xref derivedContent="6" format="counter" sectionFormat="of" target="section-6"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-references">References</xref></t>
            <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.6.2">
              <li pn="section-toc.1-1.6.2.1">
                <t indent="0" pn="section-toc.1-1.6.2.1.1"><xref derivedContent="6.1" format="counter" sectionFormat="of" target="section-6.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-normative-references">Normative References</xref></t>
              </li>
              <li pn="section-toc.1-1.6.2.2">
                <t indent="0" pn="section-toc.1-1.6.2.2.1"><xref derivedContent="6.2" format="counter" sectionFormat="of" target="section-6.2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-informative-references">Informative References</xref></t>
              </li>
            </ul>
          </li>
          <li pn="section-toc.1-1.7">
            <t indent="0" pn="section-toc.1-1.7.1"><xref derivedContent="Appendix A" format="default" sectionFormat="of" target="section-appendix.a"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-comparison-of-this-specific">Comparison of this Specification with RFC 8784</xref></t>
          </li>
          <li pn="section-toc.1-1.8">
            <t indent="0" pn="section-toc.1-1.8.1"><xref derivedContent="" format="none" sectionFormat="of" target="section-appendix.b"/><xref derivedContent="" format="title" sectionFormat="of" target="name-acknowledgements">Acknowledgements</xref></t>
          </li>
          <li pn="section-toc.1-1.9">
            <t indent="0" pn="section-toc.1-1.9.1"><xref derivedContent="" format="none" sectionFormat="of" target="section-appendix.c"/><xref derivedContent="" format="title" sectionFormat="of" target="name-authors-address">Author's Address</xref></t>
          </li>
        </ul>
      </section>
    </toc>
  </front>
  <middle>
    <section numbered="true" removeInRFC="false" toc="include" pn="section-1">
      <name slugifiedName="name-introduction">Introduction</name>
      <t indent="0" pn="section-1-1"> The Internet Key Exchange Protocol Version 2 (IKEv2), defined in <xref target="RFC7296" format="default" sectionFormat="of" derivedContent="RFC7296"/>,
            is used in the IPsec architecture for performing authenticated key exchange.
            An extension to IKEv2 for mixing preshared keys for post-quantum security is defined in <xref target="RFC8784" format="default" sectionFormat="of" derivedContent="RFC8784"/>.
            This extension allows today's IPsec traffic to be protected against future quantum computers. 
            The protection is achieved by means of using a Post-quantum Preshared Key (PPK) that is mixed into the session keys calculation.
            At the time this extension was being developed, the consensus in the IPsecME
            WG was that it was more important to protect the IPsec traffic than the IKE traffic.
It was believed that information transferred over IKE SA (including peers' identities) is less important
            and that extending the protection to also cover the initial IKE SA would require serious modifications to the core IKEv2 protocol.
            One of the goals was to minimize such changes. It was also decided that immediate rekey of initial IKE SA
            would add this protection to the new IKE SA (albeit it would not provide protection of the identity of the peers).
      </t>
      <t indent="0" pn="section-1-2"> However, in some situations, it is desirable to have this protection for the IKE SA from the very beginning,
            when an initial IKE SA is created. An example of such a situation is the Group Key Management protocol using IKEv2, 
            defined in <xref target="RFC9838" format="default" sectionFormat="of" derivedContent="RFC9838"/>. In this protocol, the group policy and session keys are transferred 
            from a Group Controller/Key Server (GCKS) to the Group Members (GMs) immediately once an initial IKE SA is created. 
            While session keys are additionally protected with a key derived from SK_d (and thus are immune to quantum computers if PPKs 
            <xref target="RFC8784" format="default" sectionFormat="of" derivedContent="RFC8784"/> are employed), the other sensitive data, including group policy, is not.
      </t>
      <t indent="0" pn="section-1-3"> Another issue with using PPKs as defined in <xref target="RFC8784" format="default" sectionFormat="of" derivedContent="RFC8784"/> is that this approach assumes that PPKs are static entities, 
            which are changed very infrequently. For this reason, PPKs are only used once when an initial IKE SA is established. 
            This restriction makes it difficult to use PPKs as defined in <xref target="RFC8784" format="default" sectionFormat="of" derivedContent="RFC8784"/> when 
            they are changed relatively frequently, for example, via the use of Quantum Key Distribution (QKD).
            If a fresh PPK becomes available before the IKE SA is expired, there is no way to use it except
            for deleting the IKE SA and recreating a new one from scratch using the fresh PPK.
      </t>
      <t indent="0" pn="section-1-4"> Some time after the protocol extension for mixing preshared keys in IKEv2 for post-quantum security was defined in <xref target="RFC8784" format="default" sectionFormat="of" derivedContent="RFC8784"/>, 
            a new IKE_INTERMEDIATE exchange for IKEv2 <xref target="RFC9242" format="default" sectionFormat="of" derivedContent="RFC9242"/> was developed. While the primary motivation for developing 
            this exchange was to allow multiple key exchanges to be used in IKEv2 (which is defined in <xref target="RFC9370" format="default" sectionFormat="of" derivedContent="RFC9370"/>),
            the IKE_INTERMEDIATE exchange itself can be used for other purposes too. 
      </t>
      <t indent="0" pn="section-1-5"> This specification defines the use of PPKs in the IKE_INTERMEDIATE exchange of IKEv2 for post-quantum security, 
            which allows getting full protection against quantum computers for initial IKE SA.
      </t>
      <t indent="0" pn="section-1-6"> This specification also defines the use of PPKs in the CREATE_CHILD_SA exchange
            for creating additional IPsec SAs and for rekeying IKE and IPsec SAs.
            This allows implementations to leverage fresh PPKs without the need to delete the IKE SA and create it from scratch.
      </t>
      <t indent="0" pn="section-1-7"> This specification does not replace the approach defined in <xref target="RFC8784" format="default" sectionFormat="of" derivedContent="RFC8784"/>.
            Both approaches for using PPKs in IKEv2 can be used depending on the circumstances
            (see <xref target="comparison" format="default" sectionFormat="of" derivedContent="Appendix A"/>).
      </t>
    </section>
    <section anchor="mustshouldmay" numbered="true" removeInRFC="false" toc="include" pn="section-2">
      <name slugifiedName="name-terminology-and-notation">Terminology and Notation</name>
      <t indent="0" pn="section-2-1">
    The key words "<bcp14>MUST</bcp14>", "<bcp14>MUST NOT</bcp14>", "<bcp14>REQUIRED</bcp14>", "<bcp14>SHALL</bcp14>", "<bcp14>SHALL NOT</bcp14>", "<bcp14>SHOULD</bcp14>", "<bcp14>SHOULD NOT</bcp14>", "<bcp14>RECOMMENDED</bcp14>", "<bcp14>NOT RECOMMENDED</bcp14>",
    "<bcp14>MAY</bcp14>", and "<bcp14>OPTIONAL</bcp14>" in this document are to be interpreted as
    described in BCP 14 <xref target="RFC2119" format="default" sectionFormat="of" derivedContent="RFC2119"/> <xref target="RFC8174" format="default" sectionFormat="of" derivedContent="RFC8174"/> 
    when, and only when, they appear in all capitals, as shown here.
      </t>
      <t indent="0" pn="section-2-2"> This document uses the terms defined in <xref target="RFC7296" format="default" sectionFormat="of" derivedContent="RFC7296"/>. In particular, 
            readers should be familiar with the terms "initiator" and "responder" as used in that document.
      </t>
      <t indent="0" pn="section-2-3"> The approach defined in <xref target="RFC8784" format="default" sectionFormat="of" derivedContent="RFC8784"/> is referred to as "using PPKs in the IKE_AUTH exchange" or simply 
            "using PPKs in IKE_AUTH" throughout this document.
      </t>
    </section>
    <section anchor="protocol" numbered="true" removeInRFC="false" toc="include" pn="section-3">
      <name slugifiedName="name-protocol-description">Protocol Description</name>
      <section anchor="init" numbered="true" removeInRFC="false" toc="include" pn="section-3.1">
        <name slugifiedName="name-creating-initial-ike-sa">Creating Initial IKE SA</name>
        <t indent="0" pn="section-3.1-1"> The IKE initiator, which supports the IKE_INTERMEDIATE exchange and wants to use a PPK to protect the initial IKE SA, 
            includes the INTERMEDIATE_EXCHANGE_SUPPORTED notification and a notification of type USE_PPK_INT in the IKE_SA_INIT request.
            If the responder supports the IKE_INTERMEDIATE exchange and is willing to use PPK for initial IKE SA protection,
            it includes both these notifications in the IKE_SA_INIT response.
        </t>
        <artwork align="left" pn="section-3.1-2">
Initiator                       Responder
------------------------------------------------------------------
HDR, SAi1, KEi, Ni,
N(INTERMEDIATE_EXCHANGE_SUPPORTED),
N(USE_PPK_INT)              ---&gt;
                        &lt;---    HDR, SAr1, KEr, Nr, [CERTREQ,]
                                N(INTERMEDIATE_EXCHANGE_SUPPORTED),
                                N(USE_PPK_INT)</artwork>
        <t indent="0" pn="section-3.1-3"> The USE_PPK_INT is a Status Type IKEv2 notification. Its Notify
        Message Type is 16445; the Protocol ID is set to 0; the Security
        Parameter Index (SPI) is absent, so the SPI Size is set to 0 too. This
        specification does not define any data that this notification may
        contain, so the Notification Data is left empty. However, future
        extensions of this specification may make use of it.  Implementations
        <bcp14>MUST</bcp14> ignore any data in the notification that they do
        not understand.
        </t>
        <t indent="0" pn="section-3.1-4"> Note that this negotiation is independent from the negotiation of using PPKs as specified in <xref target="RFC8784" format="default" sectionFormat="of" derivedContent="RFC8784"/>.
            An initiator that supports both the use of PPKs in IKE_AUTH <xref target="RFC8784" format="default" sectionFormat="of" derivedContent="RFC8784"/> and IKE_INTERMEDIATE <bcp14>MAY</bcp14> include both 
            the USE_PPK_INT and USE_PPK notifications if 
            configured to do so. However, if the responder supports both specifications 
            and is configured to use PPKs, it has to choose one to use; thus, it <bcp14>MUST</bcp14> return 
            either a USE_PPK_INT or a USE_PPK notification in the response but not both.
        </t>
        <t indent="0" pn="section-3.1-5"> If the initiator did not propose using this extension in the IKE_SA_INIT request and the responder's policy
            mandates protecting initial IKE SA with a PPK, then the responder <bcp14>MUST</bcp14> return the NO_PROPOSAL_CHOSEN notification.
        </t>
        <t indent="0" pn="section-3.1-6"> If the negotiation was successful, the initiator includes one or more 
            PPK_IDENTITY_KEY notifications in the IKE_INTERMEDIATE request with PPK identities that the initiator believes 
            are appropriate for the IKE SA being created.
        </t>
        <t indent="0" pn="section-3.1-7"> The PPK_IDENTITY_KEY is a Status Type IKEv2 notification. Its Notify Message Type
            is 16446; the Protocol ID and the SPI Size fields are both set to 0.
            The format of the Notification Data is shown below in <xref target="ppk_identity_key_format" format="default" sectionFormat="of" derivedContent="Figure 1"/>.
        </t>
        <figure anchor="ppk_identity_key_format" align="left" suppress-title="false" pn="figure-1">
          <name slugifiedName="name-ppk_identity_key-notificati">PPK_IDENTITY_KEY Notification Data Format</name>
          <artwork align="left" pn="section-3.1-8.1">
                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
~                             PPK_ID                            ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                        PPK Confirmation                       +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</artwork>
        </figure>
        <t indent="0" pn="section-3.1-9">Where:</t>
        <dl spacing="normal" newline="false" indent="3" pn="section-3.1-10">
          <dt pn="section-3.1-10.1">PPK_ID (variable):</dt>
          <dd pn="section-3.1-10.2"> PPK_ID as defined in <xref target="RFC8784" section="5.1" format="default" sectionFormat="of" derivedLink="https://rfc-editor.org/rfc/rfc8784#section-5.1" derivedContent="RFC8784"/>.  The receiver can determine the
          length of PPK_ID by subtracting 8 (the length of PPK Confirmation)
          from the Notification Data length.</dd>
          <dt pn="section-3.1-10.3">PPK Confirmation (8 octets):</dt>
          <dd pn="section-3.1-10.4">
            <t indent="0" pn="section-3.1-10.4.1">A value that allows the
          responder to check whether it has the same PPK as the initiator for
          a given PPK_ID.  This field contains the first 8 octets of a string
          computed as prf( PPK, Ni | Nr | SPIi | SPIr ), where:</t>
            <ul spacing="compact" bare="false" empty="false" indent="3" pn="section-3.1-10.4.2">
              <li pn="section-3.1-10.4.2.1">"prf" is the negotiated PRF;</li>
              <li pn="section-3.1-10.4.2.2">PPK is the key value for a specified PPK_ID;</li>
              <li pn="section-3.1-10.4.2.3">Ni, Nr, SPIi, SPIr are nonces and IKE SPIs for the SA being established.</li>
            </ul>
          </dd>
        </dl>
        <t indent="0" pn="section-3.1-11">If a series of the IKE_INTERMEDIATE exchanges takes place, the
        PPK_IDENTITY_KEY notification(s) <bcp14>MUST</bcp14> be sent in the
        last one, i.e., in the IKE_INTERMEDIATE exchange immediately preceding
        the IKE_AUTH exchange. If this IKE_INTERMEDIATE exchange contains
        other payloads aimed for some other purpose, then the notification(s)
        <bcp14>MAY</bcp14> be piggybacked with these payloads. Note that
        future IKEv2 extensions utilizing the IKE_INTERMEDIATE exchange may
        allow one or more of these exchanges to happen after the one concerned
        with PPK for the case when such extensions are negotiated.</t>
        <artwork align="left" pn="section-3.1-12">
Initiator                         Responder
------------------------------------------------------------------
HDR, SK { ... N(PPK_IDENTITY_KEY, PPK_ID_1)
           [, N(PPK_IDENTITY_KEY, PPK_ID_2)] ...
           [, N(PPK_IDENTITY_KEY, PPK_ID_n)]}   ---&gt;</artwork>
        <t indent="0" pn="section-3.1-13">
            Depending on the responder's capabilities and policy, the following situations are possible:
        </t>
        <ol type="1" indent="adaptive" spacing="normal" start="1" pn="section-3.1-14">
          <li anchor="case1" pn="section-3.1-14.1" derivedCounter="1.">
            <t indent="0" pn="section-3.1-14.1.1">If the responder is configured with a PPK with an ID that is
            among the IDs sent by the initiator, and if this PPK matches the
            initiator's PPK (based on the information from the PPK
            Confirmation field), then the responder selects this PPK and
            returns its identity in the PPK_IDENTITY notification.  The
            PPK_IDENTITY notification is defined in <xref target="RFC8784" format="default" sectionFormat="of" derivedContent="RFC8784"/>.
            </t>
            <artwork align="left" pn="section-3.1-14.1.2">
Initiator                       Responder
---------------------------------------------------------------
               &lt;---    HDR, SK { ... N(PPK_IDENTITY, PPK_ID_i)}</artwork>
            <t indent="0" pn="section-3.1-14.1.3">
              In this case, the IKE_AUTH exchange is performed as defined in IKEv2 <xref target="RFC7296" format="default" sectionFormat="of" derivedContent="RFC7296"/>.
              However, the keys for the IKE SA are computed using PPK, as described in <xref target="init_keys" format="default" sectionFormat="of" derivedContent="Section 3.1.1"/>.
              If the responder returns a PPK identity that was not proposed by the initiator, then the initiator
              <bcp14>MUST</bcp14> treat this as fatal and abort the IKE SA establishment.
            </t>
          </li>
          <li anchor="case2" pn="section-3.1-14.2" derivedCounter="2.">
            <t indent="0" pn="section-3.1-14.2.1">If the responder does not have a PPK with an ID that matches any
            of IDs sent by the initiator, or if the responder has some of the
            proposed PPKs but their values are mismatched from the initiator's
            PPKs (based on the information from the PPK Confirmation field),
            and if using PPK is mandatory for the responder, then it
            <bcp14>MUST</bcp14> return an AUTHENTICATION_FAILED notification
            and abort creating the IKE SA.
            </t>
            <artwork align="left" pn="section-3.1-14.2.2">
Initiator                       Responder
---------------------------------------------------------------
                 &lt;---    HDR, SK {... N(AUTHENTICATION_FAILED)}</artwork>
          </li>
          <li anchor="case3" pn="section-3.1-14.3" derivedCounter="3.">
            <t indent="0" pn="section-3.1-14.3.1">
              If the responder does not have any PPKs proposed by the initiator,
              or if it has only some of the proposed PPKs but their values mismatch the initiator's ones 
              (based on the information from the PPK Confirmation field), and if using PPK is optional for the responder,
              then it does not include any PPK_IDENTITY notification to the response. 
            </t>
            <artwork align="left" pn="section-3.1-14.3.2">
Initiator                       Responder
---------------------------------------------------------------
                        &lt;---    HDR, SK {...}</artwork>
            <t indent="0" pn="section-3.1-14.3.3">
              In this case, the initiator cannot achieve quantum computer resistance using the proposed PPKs.
              If this is a requirement for the initiator, then it <bcp14>MUST</bcp14> abort creating the IKE SA. 
              Otherwise, the initiator continues with the IKE_AUTH exchange as described in IKEv2 <xref target="RFC7296" format="default" sectionFormat="of" derivedContent="RFC7296"/>. 
            </t>
          </li>
        </ol>
        <t indent="0" pn="section-3.1-15"><xref target="responders_behavior" format="default" sectionFormat="of" derivedContent="Table 1"/> summarizes the above logic for the responder:</t>
        <table anchor="responders_behavior" align="center" pn="table-1">
          <name slugifiedName="name-responders-behavior">Responder's Behavior</name>
          <thead>
            <tr>
              <th align="left" colspan="1" rowspan="1">Received USE_PPK_INT</th>
              <th align="left" colspan="1" rowspan="1">Supports USE_PPK_INT</th>
              <th align="left" colspan="1" rowspan="1">Has one of the proposed PPKs</th>
              <th align="left" colspan="1" rowspan="1">PPK is mandatory for initial IKE SA</th>
              <th align="left" colspan="1" rowspan="1">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left" colspan="1" rowspan="1">No</td>
              <td align="left" colspan="1" rowspan="1">*</td>
              <td align="left" colspan="1" rowspan="1">*</td>
              <td align="left" colspan="1" rowspan="1">No</td>
              <td align="left" colspan="1" rowspan="1">
                <xref target="RFC8784" format="default" sectionFormat="of" derivedContent="RFC8784"/> (if proposed) or standard IKEv2 protocol</td>
            </tr>
            <tr>
              <td align="left" colspan="1" rowspan="1">No</td>
              <td align="left" colspan="1" rowspan="1">Yes</td>
              <td align="left" colspan="1" rowspan="1">*</td>
              <td align="left" colspan="1" rowspan="1">Yes</td>
              <td align="left" colspan="1" rowspan="1">Send NO_PROPOSAL_CHOSEN</td>
            </tr>
            <tr>
              <td align="left" colspan="1" rowspan="1">Yes</td>
              <td align="left" colspan="1" rowspan="1">Yes</td>
              <td align="left" colspan="1" rowspan="1">Yes</td>
              <td align="left" colspan="1" rowspan="1">*</td>
              <td align="left" colspan="1" rowspan="1">
                <xref target="case1" format="default" sectionFormat="of" derivedContent="Section 3.1, Paragraph 14, Item 1"/> (use this extension)</td>
            </tr>
            <tr>
              <td align="left" colspan="1" rowspan="1">Yes</td>
              <td align="left" colspan="1" rowspan="1">Yes</td>
              <td align="left" colspan="1" rowspan="1">No</td>
              <td align="left" colspan="1" rowspan="1">Yes</td>
              <td align="left" colspan="1" rowspan="1">
                <xref target="case2" format="default" sectionFormat="of" derivedContent="Section 3.1, Paragraph 14, Item 2"/> (abort negotiation)</td>
            </tr>
            <tr>
              <td align="left" colspan="1" rowspan="1">Yes</td>
              <td align="left" colspan="1" rowspan="1">Yes</td>
              <td align="left" colspan="1" rowspan="1">No</td>
              <td align="left" colspan="1" rowspan="1">No</td>
              <td align="left" colspan="1" rowspan="1">
                <xref target="case3" format="default" sectionFormat="of" derivedContent="Section 3.1, Paragraph 14, Item 3"/> (standard IKEv2 protocol)</td>
            </tr>
          </tbody>
        </table>
        <t indent="0" pn="section-3.1-17"> Since the responder selects a PPK before it knows the identity of the initiator, a situation may occur
            where the responder agrees to use some PPK in the IKE_INTERMEDIATE exchange but then, during the IKE_AUTH exchange, 
            discovers that this particular PPK is not associated with the initiator's identity in its local policy.
            Note that the responder does have this PPK, but it is just not listed among the PPKs to be used with this initiator.
            In this case, the responder <bcp14>SHOULD</bcp14> abort negotiation and return back the AUTHENTICATION_FAILED notification
            to be consistent with its policy. However, the responder <bcp14>MAY</bcp14> continue creating IKE SA using the negotiated 
            "wrong" PPK if this is acceptable according to its local policy.
        </t>
        <section anchor="init_keys" numbered="true" removeInRFC="false" toc="include" pn="section-3.1.1">
          <name slugifiedName="name-computing-ike-sa-keys">Computing IKE SA Keys</name>
          <t indent="0" pn="section-3.1.1-1">Once the PPK is negotiated in the IKE_INTERMEDIATE exchange, the
	  IKE SA keys are recalculated.  Note that if the IKE SA keys are also
	  recalculated as a result of other actions performed in this
	  IKE_INTERMEDIATE exchange (for example, as defined in <xref target="RFC9370" format="default" sectionFormat="of" derivedContent="RFC9370"/>), then applying the PPK <bcp14>MUST</bcp14> be
	  done after all of them so that recalculating IKE SA keys with the
	  PPK is the last action before they are used in the next
	  exchange. Note that future IKEv2 extensions utilizing the
	  IKE_INTERMEDIATE exchange may update this requirement for the case
	  when such extensions are negotiated.
          </t>
          <t indent="0" pn="section-3.1.1-2"> The IKE SA keys are computed differently compared to how PPKs
          are used in IKE_AUTH.  A new SKEYSEED' value is computed using the
          negotiated PPK and the most recently computed SK_d key.  Note that
          the PPK is applied to SK_d exactly how it is specified in <xref target="RFC8784" format="default" sectionFormat="of" derivedContent="RFC8784"/>, and the result is used as SKEYSEED'.
          </t>
          <artwork align="left" pn="section-3.1.1-3">
SKEYSEED' = prf+ (PPK, SK_d)</artwork>
          <t indent="0" pn="section-3.1.1-4">
              Then the SKEYSEED' is used to recalculate all SK_* keys as defined in <xref target="RFC7296" section="2.14" format="default" sectionFormat="of" derivedLink="https://rfc-editor.org/rfc/rfc7296#section-2.14" derivedContent="RFC7296"/>.

          </t>
          <artwork align="left" pn="section-3.1.1-5">
{SK_d | SK_ai | SK_ar | SK_ei | SK_er | SK_pi | SK_pr}
                           = prf+ (SKEYSEED', Ni | Nr | SPIi | SPIr )</artwork>
          <t indent="0" pn="section-3.1.1-6">

              In the formula above, Ni and Nr are nonces from the IKE_SA_INIT exchange, and SPIi and SPIr are the SPIs of the IKE SA being created.
              Note that SK_d, SK_pi, and SK_pr are not individually recalculated using PPK, as defined in <xref target="RFC8784" format="default" sectionFormat="of" derivedContent="RFC8784"/>.
          </t>
          <t indent="0" pn="section-3.1.1-7"> The resulting keys are then used in the IKE_AUTH exchange and in the created IKE SA.
          </t>
        </section>
      </section>
      <section anchor="create_child_sa" numbered="true" removeInRFC="false" toc="include" pn="section-3.2">
        <name slugifiedName="name-using-ppks-in-the-create_ch">Using PPKs in the CREATE_CHILD_SA Exchange</name>
        <t indent="0" pn="section-3.2-1"> If a fresh PPK is available to both peers at the time when an IKE SA is active, 
            peers <bcp14>MAY</bcp14> use this fresh PPK without creating a new IKE SA from scratch
            when they have a need to create additional IPsec SAs or to rekey existing SAs.
            In this case, the PPK can be used for creating additional IPsec SAs and for rekeying both IKE and IPsec SAs
            regardless of whether the current IKE SA was created with the use of a PPK 
            (no matter how: in IKE_AUTH, in IKE_INTERMEDIATE, or in CREATE_CHILD_SA) or not.
        </t>
        <t indent="0" pn="section-3.2-2"> If the initiator wants to use a PPK in the CREATE_CHILD_SA exchange, it includes one or more 
            PPK_IDENTITY_KEY notifications containing PPK identities that the initiator believes 
            are appropriate for the SA being created in the CREATE_CHILD_SA request.
            In this case, the PPK Confirmation field contains the first 8 octets of a string computed as prf( PPK, Ni | SPIi | SPIr ),
            where Ni is the initiator's nonce from the CREATE_CHILD_SA request and SPIi/SPIr are the SPIs of the current IKE SA.
            If the responder supports using PPKs in the CREATE_CHILD_SA exchange and is configured and ready to do it, 
            then it sends back the PPK_IDENTITY notification containing the ID of the selected PPK, as depicted in the figures below.

</t>
        <figure align="left" suppress-title="false" pn="figure-2">
          <name slugifiedName="name-create_child_sa-exchange-fo">CREATE_CHILD_SA Exchange for Creating or Rekeying Child SAs</name>
          <artwork align="left" pn="section-3.2-3.1">
Initiator                         Responder
------------------------------------------------------------------
HDR, SK {[N(REKEY_SA),] SA, Ni, [KEi,] TSi, TSr,
        N(PPK_IDENTITY_KEY, PPK_ID_1)
        [, N(PPK_IDENTITY_KEY, PPK_ID_2)] ...
        [, N(PPK_IDENTITY_KEY, PPK_ID_n)]}   ---&gt;

                         &lt;---    HDR, SK {SA, Nr [KEr,] TSi, TSr,
                                         N(PPK_IDENTITY, PPK_ID_i)}</artwork>
        </figure>
        <figure align="left" suppress-title="false" pn="figure-3">
          <name slugifiedName="name-create_child_sa-exchange-for">CREATE_CHILD_SA Exchange for Rekeying IKE SA</name>
          <artwork align="left" pn="section-3.2-4.1">
Initiator                         Responder
------------------------------------------------------------------
HDR, SK {SA, Ni, KEi,
        N(PPK_IDENTITY_KEY, PPK_ID_1)
        [, N(PPK_IDENTITY_KEY, PPK_ID_2)] ...
        [, N(PPK_IDENTITY_KEY, PPK_ID_n)]}   ---&gt;

                         &lt;---    HDR, SK {SA, Nr, KEr,
                                         N(PPK_IDENTITY, PPK_ID_i)}</artwork>
        </figure>
        <t indent="0" pn="section-3.2-5">
	  If the responder does not support (or is not configured for) using
	  PPKs in the CREATE_CHILD_SA exchange or does not have a PPK with an
	  ID that matches any of IDs sent by the initiator, or if the
	  responder has some of the proposed PPKs but their values are
	  mismatched from the initiator's PPKs (based on the information from
	  the PPK Confirmation field), then it will not include any
	  PPK_IDENTITY notifications in the response, and new SA is created as
	  defined in IKEv2 <xref target="RFC7296" format="default" sectionFormat="of" derivedContent="RFC7296"/>. If this is inappropriate
	  for the initiator, it can immediately delete this SA.
        </t>
        <t indent="0" pn="section-3.2-6">
	  If using PPKs in CREATE_CHILD_SA is mandatory for the responder, and
	  the initiator does not include any PPK_IDENTITY_KEY notifications in
	  the request, or if the responder does not have a PPK with an ID that
	  matches any of IDs sent by the initiator, or if the responder has
	  some of the proposed PPKs but with mismatched values from the
	  initiator's PPKs (based on the information from the PPK Confirmation
	  field), then the responder <bcp14>MUST</bcp14> return the
	  NO_PROPOSAL_CHOSEN notification.
        </t>
        <t indent="0" pn="section-3.2-7"> Otherwise, the new SA is created using the selected PPK.
        </t>
        <section anchor="create_child_sa_keys" numbered="true" removeInRFC="false" toc="include" pn="section-3.2.1">
          <name slugifiedName="name-computing-keys">Computing Keys</name>
          <t indent="0" pn="section-3.2.1-1"> For the purpose of calculation session keys for the new SA, the current SK_d key is first
              mixed with the selected PPK:

          </t>
          <artwork align="left" pn="section-3.2.1-2">
SK_d' = prf+ (PPK, SK_d)</artwork>
          <t indent="0" pn="section-3.2.1-3">

              The resulting key SK_d' is then used instead of SK_d in all formulas for computing keys for the new SA
              (Sections <xref target="RFC7296" sectionFormat="bare" section="2.17" format="default" derivedLink="https://rfc-editor.org/rfc/rfc7296#section-2.17" derivedContent="RFC7296"/> and <xref target="RFC7296" sectionFormat="bare" section="2.18" format="default" derivedLink="https://rfc-editor.org/rfc/rfc7296#section-2.18" derivedContent="RFC7296"/> of <xref target="RFC7296" format="default" sectionFormat="of" derivedContent="RFC7296"/> and <xref target="RFC9370" section="2.2.4" format="default" sectionFormat="of" derivedLink="https://rfc-editor.org/rfc/rfc9370#section-2.2.4" derivedContent="RFC9370"/>).
          </t>
          <t indent="0" pn="section-3.2.1-4"> Note that if the PPK that was used for the IKE SA establishment is not changed, then there is no point
              to use it in the CREATE_CHILD_SA exchange.
          </t>
        </section>
      </section>
    </section>
    <section anchor="security" numbered="true" removeInRFC="false" toc="include" pn="section-4">
      <name slugifiedName="name-security-considerations">Security Considerations</name>
      <t indent="0" pn="section-4-1"> Security considerations for using Post-quantum Preshared Keys
            in the IKEv2 protocol are discussed in <xref target="RFC8784" format="default" sectionFormat="of" derivedContent="RFC8784"/>.
            Unlike using PPKs in IKE_AUTH, this specification makes even initial IKE SA quantum
            secure. In addition, a PPK is mixed into the SK_* keys calculation 
            before the IKE_AUTH exchange starts, and since the PPK is used in authentication too, 
            this exchange is quantum secure even against an active attacker.
      </t>
      <t indent="0" pn="section-4-2"> This specification relies on the IKE_INTERMEDIATE exchange.
            Refer to <xref target="RFC9242" format="default" sectionFormat="of" derivedContent="RFC9242"/> for discussion of related security issues.
      </t>
      <t indent="0" pn="section-4-3"> <xref target="RFC9370" section="4" format="default" sectionFormat="of" derivedLink="https://rfc-editor.org/rfc/rfc9370#section-4" derivedContent="RFC9370"/> discusses the potential impact
      of when a CRQC is accessible on various cryptographic primitives used in
      IKEv2.  It is worthwhile to repeat here that it is believed that the
      security of symmetric key cryptographic primitives will not be affected
      by CRQC.
      </t>
    </section>
    <section anchor="iana" numbered="true" removeInRFC="false" toc="include" pn="section-5">
      <name slugifiedName="name-iana-considerations">IANA Considerations</name>
      <t indent="0" pn="section-5-1">Per this document, IANA has added the following Notify Message Types in the "IKEv2 Notify Message Status Types" registry:</t>
      <dl spacing="compact" newline="false" indent="3" pn="section-5-2">
        <dt pn="section-5-2.1">16445</dt>
        <dd pn="section-5-2.2">USE_PPK_INT</dd>
        <dt pn="section-5-2.3">16446</dt>
        <dd pn="section-5-2.4">PPK_IDENTITY_KEY</dd>
      </dl>
    </section>
  </middle>
  <back>
    <references pn="section-6">
      <name slugifiedName="name-references">References</name>
      <references pn="section-6.1">
        <name slugifiedName="name-normative-references">Normative References</name>
        <reference anchor="RFC2119" target="https://www.rfc-editor.org/info/rfc2119" quoteTitle="true" derivedAnchor="RFC2119">
          <front>
            <title>Key words for use in RFCs to Indicate Requirement Levels</title>
            <author fullname="S. Bradner" initials="S." surname="Bradner"/>
            <date month="March" year="1997"/>
            <abstract>
              <t indent="0">In many standards track documents several words are used to signify the requirements in the specification. These words are often capitalized. This document defines these words as they should be interpreted in IETF documents. This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t>
            </abstract>
          </front>
          <seriesInfo name="BCP" value="14"/>
          <seriesInfo name="RFC" value="2119"/>
          <seriesInfo name="DOI" value="10.17487/RFC2119"/>
        </reference>
        <reference anchor="RFC8174" target="https://www.rfc-editor.org/info/rfc8174" quoteTitle="true" derivedAnchor="RFC8174">
          <front>
            <title>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</title>
            <author fullname="B. Leiba" initials="B." surname="Leiba"/>
            <date month="May" year="2017"/>
            <abstract>
              <t indent="0">RFC 2119 specifies common key words that may be used in protocol specifications. This document aims to reduce the ambiguity by clarifying that only UPPERCASE usage of the key words have the defined special meanings.</t>
            </abstract>
          </front>
          <seriesInfo name="BCP" value="14"/>
          <seriesInfo name="RFC" value="8174"/>
          <seriesInfo name="DOI" value="10.17487/RFC8174"/>
        </reference>
        <reference anchor="RFC7296" target="https://www.rfc-editor.org/info/rfc7296" quoteTitle="true" derivedAnchor="RFC7296">
          <front>
            <title>Internet Key Exchange Protocol Version 2 (IKEv2)</title>
            <author fullname="C. Kaufman" initials="C." surname="Kaufman"/>
            <author fullname="P. Hoffman" initials="P." surname="Hoffman"/>
            <author fullname="Y. Nir" initials="Y." surname="Nir"/>
            <author fullname="P. Eronen" initials="P." surname="Eronen"/>
            <author fullname="T. Kivinen" initials="T." surname="Kivinen"/>
            <date month="October" year="2014"/>
            <abstract>
              <t indent="0">This document describes version 2 of the Internet Key Exchange (IKE) protocol. IKE is a component of IPsec used for performing mutual authentication and establishing and maintaining Security Associations (SAs). This document obsoletes RFC 5996, and includes all of the errata for it. It advances IKEv2 to be an Internet Standard.</t>
            </abstract>
          </front>
          <seriesInfo name="STD" value="79"/>
          <seriesInfo name="RFC" value="7296"/>
          <seriesInfo name="DOI" value="10.17487/RFC7296"/>
        </reference>
        <reference anchor="RFC8784" target="https://www.rfc-editor.org/info/rfc8784" quoteTitle="true" derivedAnchor="RFC8784">
          <front>
            <title>Mixing Preshared Keys in the Internet Key Exchange Protocol Version 2 (IKEv2) for Post-quantum Security</title>
            <author fullname="S. Fluhrer" initials="S." surname="Fluhrer"/>
            <author fullname="P. Kampanakis" initials="P." surname="Kampanakis"/>
            <author fullname="D. McGrew" initials="D." surname="McGrew"/>
            <author fullname="V. Smyslov" initials="V." surname="Smyslov"/>
            <date month="June" year="2020"/>
            <abstract>
              <t indent="0">The possibility of quantum computers poses a serious challenge to cryptographic algorithms deployed widely today. The Internet Key Exchange Protocol Version 2 (IKEv2) is one example of a cryptosystem that could be broken; someone storing VPN communications today could decrypt them at a later time when a quantum computer is available. It is anticipated that IKEv2 will be extended to support quantum-secure key exchange algorithms; however, that is not likely to happen in the near term. To address this problem before then, this document describes an extension of IKEv2 to allow it to be resistant to a quantum computer by using preshared keys.</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="8784"/>
          <seriesInfo name="DOI" value="10.17487/RFC8784"/>
        </reference>
        <reference anchor="RFC9242" target="https://www.rfc-editor.org/info/rfc9242" quoteTitle="true" derivedAnchor="RFC9242">
          <front>
            <title>Intermediate Exchange in the Internet Key Exchange Protocol Version 2 (IKEv2)</title>
            <author fullname="V. Smyslov" initials="V." surname="Smyslov"/>
            <date month="May" year="2022"/>
            <abstract>
              <t indent="0">This document defines a new exchange, called "Intermediate Exchange", for the Internet Key Exchange Protocol Version 2 (IKEv2). This exchange can be used for transferring large amounts of data in the process of IKEv2 Security Association (SA) establishment. An example of the need to do this is using key exchange methods resistant to Quantum Computers (QCs) for IKE SA establishment. The Intermediate Exchange makes it possible to use the existing IKE fragmentation mechanism (which cannot be used in the initial IKEv2 exchange), helping to avoid IP fragmentation of large IKE messages if they need to be sent before IKEv2 SA is established.</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="9242"/>
          <seriesInfo name="DOI" value="10.17487/RFC9242"/>
        </reference>
      </references>
      <references pn="section-6.2">
        <name slugifiedName="name-informative-references">Informative References</name>
        <reference anchor="RFC9838" target="https://www.rfc-editor.org/info/rfc9838" quoteTitle="true" derivedAnchor="RFC9838">
          <front>
            <title>Group Key Management Using the Internet Key Exchange Protocol Version 2 (IKEv2)</title>
            <author initials="V" surname="Smyslov" fullname="Valery Smyslov">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="B" surname="Weis" fullname="Brian Weis">
              <organization showOnFrontPage="true"/>
            </author>
            <date month="November" year="2025"/>
          </front>
          <seriesInfo name="RFC" value="9838"/>
          <seriesInfo name="DOI" value="10.17487/RFC9838"/>
        </reference>
        <reference anchor="RFC9370" target="https://www.rfc-editor.org/info/rfc9370" quoteTitle="true" derivedAnchor="RFC9370">
          <front>
            <title>Multiple Key Exchanges in the Internet Key Exchange Protocol Version 2 (IKEv2)</title>
            <author fullname="CJ. Tjhai" initials="CJ." surname="Tjhai"/>
            <author fullname="M. Tomlinson" initials="M." surname="Tomlinson"/>
            <author fullname="G. Bartlett" initials="G." surname="Bartlett"/>
            <author fullname="S. Fluhrer" initials="S." surname="Fluhrer"/>
            <author fullname="D. Van Geest" initials="D." surname="Van Geest"/>
            <author fullname="O. Garcia-Morchon" initials="O." surname="Garcia-Morchon"/>
            <author fullname="V. Smyslov" initials="V." surname="Smyslov"/>
            <date month="May" year="2023"/>
            <abstract>
              <t indent="0">This document describes how to extend the Internet Key Exchange Protocol Version 2 (IKEv2) to allow multiple key exchanges to take place while computing a shared secret during a Security Association (SA) setup.</t>
              <t indent="0">This document utilizes the IKE_INTERMEDIATE exchange, where multiple key exchanges are performed when an IKE SA is being established. It also introduces a new IKEv2 exchange, IKE_FOLLOWUP_KE, which is used for the same purpose when the IKE SA is being rekeyed or is creating additional Child SAs.</t>
              <t indent="0">This document updates RFC 7296 by renaming a Transform Type 4 from "Diffie-Hellman Group (D-H)" to "Key Exchange Method (KE)" and renaming a field in the Key Exchange Payload from "Diffie-Hellman Group Num" to "Key Exchange Method". It also renames an IANA registry for this Transform Type from "Transform Type 4 - Diffie- Hellman Group Transform IDs" to "Transform Type 4 - Key Exchange Method Transform IDs". These changes generalize key exchange algorithms that can be used in IKEv2.</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="9370"/>
          <seriesInfo name="DOI" value="10.17487/RFC9370"/>
        </reference>
      </references>
    </references>
    <section anchor="comparison" numbered="true" removeInRFC="false" toc="include" pn="section-appendix.a">
      <name slugifiedName="name-comparison-of-this-specific">Comparison of this Specification with RFC 8784</name>
      <t indent="0" pn="section-appendix.a-1"> This specification is not intended to be a replacement for using PPKs in IKE_AUTH as defined in <xref target="RFC8784" format="default" sectionFormat="of" derivedContent="RFC8784"/>.
            Instead, it is supposed to be used in situations where the approach defined there 
            does not meet the requirements, like the need to make the initial IKE SA quantum-secure or 
            the need to choose between several available PPKs.
            However, if the peers support both using PPKs in IKE_AUTH and this specification, 
            then the latter may also be used in situations where using PPKs in IKE_AUTH suffices
            (e.g., when the initial IKE SA is not required to be quantum-protected).
      </t>
      <t indent="0" pn="section-appendix.a-2"> The approach defined in this document has the following advantages:
      </t>
      <ol spacing="normal" type="1" indent="adaptive" start="1" pn="section-appendix.a-3">
	<li pn="section-appendix.a-3.1" derivedCounter="1.">
          <t indent="0" pn="section-appendix.a-3.1.1"> The main advantage of using PPK in the IKE_INTERMEDIATE exchange instead of the IKE_AUTH exchange is that it allows IKE_AUTH to be fully protected. 
                This means that the ID payloads and any other sensitive content sent in the IKE_AUTH are protected against quantum computers.
                The same is true for the sensitive data sent in the GSA_AUTH exchange in the G-IKEv2 protocol <xref target="RFC9838" format="default" sectionFormat="of" derivedContent="RFC9838"/>.
          </t>
        </li>
        <li pn="section-appendix.a-3.2" derivedCounter="2.">
          <t indent="0" pn="section-appendix.a-3.2.1"> In addition to the IKE_AUTH exchange being fully protected, the initial IKE SA is also fully protected, which is important when
                sensitive information is transferred over initial IKE SA. Examples of such a
                situation are the CREATE_CHILD_SA exchange of IKEv2 and the GSA_REGISTRATION exchange of G-IKEv2 <xref target="RFC9838" format="default" sectionFormat="of" derivedContent="RFC9838"/>.
          </t>
        </li>
        <li pn="section-appendix.a-3.3" derivedCounter="3.">
          <t indent="0" pn="section-appendix.a-3.3.1"> As the PPK exchange happens as a separate exchange before IKE_AUTH, this means that initiator can propose several PPKs and
                the responder can pick one. This is not possible when the PPK exchange happens in the IKE_AUTH. This feature could simplify PPK
                rollover.
          </t>
        </li>
        <li pn="section-appendix.a-3.4" derivedCounter="4.">
          <t indent="0" pn="section-appendix.a-3.4.1"> With this specification there is no need for the initiator to calculate the content of the AUTH payload twice (with and
                without PPK) to support a situation when using PPK is optional for both sides.
          </t>
        </li>
      </ol>
      <t indent="0" pn="section-appendix.a-4">
            The main disadvantage of the approach defined in this document is that it always requires an additional round trip (the IKE_INTERMEDIATE exchange)
            to set up the IKE SA and the initial IPsec SA. However, if the IKE_INTERMEDIATE exchange has to be used for some other purposes in any case,
            then the PPK-related payloads can be piggybacked with other payloads, thus eliminating this penalty.
      </t>
    </section>
    <section anchor="acknowledgements" numbered="false" removeInRFC="false" toc="include" pn="section-appendix.b">
      <name slugifiedName="name-acknowledgements">Acknowledgements</name>
      <t indent="0" pn="section-appendix.b-1"> Author would like to thank <contact fullname="Paul Wouters"/> for
      valuable comments and <contact fullname="Tero Kivinen"/> who made a
      thorough review of the document and proposed a lot of text improvements,
      and who also pointed out to the problem of mismatched preshared
      keys. Thanks to <contact fullname="Rebecca Guthrie"/> for providing
      comments and proposals for the document and to <contact fullname="Mikhail Borodin"/> for discovering the problem of calculating
      PPK Confirmation in CREATE_CHILD_SA.</t>
    </section>
    <section anchor="authors-addresses" numbered="false" removeInRFC="false" toc="include" pn="section-appendix.c">
      <name slugifiedName="name-authors-address">Author's Address</name>
      <author initials="V." surname="Smyslov" fullname="Valery Smyslov">
        <organization showOnFrontPage="true">ELVIS-PLUS</organization>
        <address>
          <postal>
            <street>PO Box 81</street>
            <city>Moscow (Zelenograd)</city>
            <code>124460</code>
            <country>Russian Federation</country>
          </postal>
          <phone>+7 495 276 0211</phone>
          <email>svan@elvis.ru</email>
        </address>
      </author>
    </section>
  </back>
</rfc>
